# Task 1: LLM í†µí•© - ì™„ë£Œ ë³´ê³ ì„œ

## ğŸ“‹ ê°œìš”

**ëª©í‘œ:** OpenAI GPT-4ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³ ê° ë©”ì‹œì§€ì— ëŒ€í•œ ìë™ AI ì‘ë‹µ ìƒì„±
**ìƒíƒœ:** âœ… ì™„ë£Œ
**ì™„ë£Œ ë‚ ì§œ:** 2025-10-30
**ì†Œìš” ì‹œê°„:** ì•½ 3ì‹œê°„

## ğŸ¯ ë‹¬ì„± ì‚¬í•­

### 1. í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„

#### LLM ì„œë¹„ìŠ¤ í†µí•©
- âœ… [backend/app/services/conversation_service.py](../backend/app/services/conversation_service.py)
  - LLMService ì˜ì¡´ì„± ì£¼ì…
  - `_generate_and_save_ai_response()` ë©”ì„œë“œ êµ¬í˜„
  - í•œê¸€ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (5ê°€ì§€ ìƒë‹´ ì›ì¹™)
  - Fallback ì²˜ë¦¬ (LLM ì˜¤ë¥˜ ì‹œ ì•ˆë‚´ ë©”ì‹œì§€)

#### API ë¼ìš°íŠ¸ ìˆ˜ì •
- âœ… [backend/app/api/routes/conversations.py](../backend/app/api/routes/conversations.py)
  - `get_llm_service()` ì˜ì¡´ì„± í•¨ìˆ˜ ìƒì„±
  - ConversationServiceì— LLMService ì „ë‹¬

#### ì„¤ì • ìˆ˜ì •
- âœ… [backend/core/config/__init__.py](../backend/core/config/__init__.py)
  - `.env` íŒŒì¼ ê²½ë¡œ ìˆ˜ì • (`parents[3]` â†’ í”„ë¡œì íŠ¸ ë£¨íŠ¸)
  - OPENAI_API_KEY í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ

#### ë²„ê·¸ ìˆ˜ì •
- âœ… [backend/app/repositories/conversation_repository.py](../backend/app/repositories/conversation_repository.py)
  - ë¦¬ìŠ¤íŠ¸ ì°¸ì¡° ë¬¸ì œ í•´ê²° (ë³µì‚¬ë³¸ ë°˜í™˜)

### 2. í…ŒìŠ¤íŠ¸ êµ¬í˜„

#### ìœ ë‹› í…ŒìŠ¤íŠ¸ (ëª¨í‚¹)
- âœ… [backend/tests/unit/test_conversation_service.py](../backend/tests/unit/test_conversation_service.py)
  - 6ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
  - LLM ëª¨í‚¹ìœ¼ë¡œ ë¹„ìš© 0ì›
  - ì‹¤í–‰ ì‹œê°„: < 1ì´ˆ

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤:**
1. âœ… `test_start_conversation_creates_conversation_and_ai_response` - AI ì‘ë‹µ ìƒì„± í™•ì¸
2. âœ… `test_start_conversation_handles_llm_failure_with_fallback` - Fallback ì²˜ë¦¬ í™•ì¸
3. âœ… `test_start_conversation_assigns_correct_sequence_numbers` - ë©”ì‹œì§€ ìˆœì„œ í™•ì¸
4. âœ… `test_start_conversation_stores_ai_message_in_repository` - ì €ì¥ì†Œ ì €ì¥ í™•ì¸
5. âœ… `test_start_conversation_with_organization_id` - ì¡°ì§ ID ì²˜ë¦¬ í™•ì¸
6. âœ… `test_start_conversation_pending_approval_defaults_to_false` - HITL ê¸°ë³¸ê°’ í™•ì¸

#### í†µí•© í…ŒìŠ¤íŠ¸ (ì‹¤ì œ API)
- âœ… [backend/tests/integration/test_llm_integration.py](../backend/tests/integration/test_llm_integration.py)
  - 5ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
  - ì‹¤ì œ OpenAI API í˜¸ì¶œ
  - ì´ ë¹„ìš©: ~$0.0005

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤:**
1. âœ… `test_llm_service_generates_real_response` - ì‹¤ì œ API ì‘ë‹µ í™•ì¸
2. âœ… `test_llm_service_handles_korean_well` - í•œê¸€ ì‘ë‹µ í’ˆì§ˆ í™•ì¸
3. âœ… `test_conversation_api_with_real_llm` - ì „ì²´ API í”Œë¡œìš° í™•ì¸
4. âœ… `test_llm_service_retry_on_failure` - Retry ë©”ì»¤ë‹ˆì¦˜ í™•ì¸
5. âœ… `test_conversation_api_metadata_preserved` - ë©”íƒ€ë°ì´í„° ë³´ì¡´ í™•ì¸

### 3. ë¬¸ì„œí™”

#### í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
- âœ… [docs/testing-llm-integration.md](testing-llm-integration.md)
  - í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ë°©ë²•
  - ìœ ë‹› í…ŒìŠ¤íŠ¸ vs í†µí•© í…ŒìŠ¤íŠ¸
  - API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ ë°©ë²•
  - ë¹„ìš© ê´€ë¦¬ ì „ëµ
  - íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

#### ê³„ì•½ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
- âœ… [backend/tests/contract/test_conversations.py](../backend/tests/contract/test_conversations.py)
  - OPENAI_API_KEY í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€

## ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ìœ ë‹› í…ŒìŠ¤íŠ¸
```
6 passed, 1 warning in 0.38s
```

### í†µí•© í…ŒìŠ¤íŠ¸
```
5 passed, 6 warnings in 7.47s

âœ… AI Response: ì•ˆë…•í•˜ì„¸ìš”! ë°°ì†¡ ë¬¸ì˜í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤...
ğŸ’° Tokens used: 65
âš¡ Latency: 1103ms

ğŸ‡°ğŸ‡· Korean Response: ì•ˆë…•í•˜ì„¸ìš”. ì£¼ë¬¸ ì·¨ì†Œë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤...

ğŸ‘¤ Customer: ì£¼ë¬¸ ì·¨ì†Œ ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤. ì–´ë–»ê²Œ í•˜ë‚˜ìš”?
ğŸ¤– AI: ì•ˆë…•í•˜ì„¸ìš” ê³ ê°ë‹˜, ì£¼ë¬¸ ì·¨ì†Œë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤...
```

## ğŸ”§ ê¸°ìˆ  ì„¸ë¶€ì‚¬í•­

### ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
```
ë‹¹ì‹ ì€ ì „ë¬¸ì ì´ê³  ì¹œì ˆí•œ ê³ ê° ìƒë‹´ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

ë‹¤ìŒ ì›ì¹™ì„ ë”°ë¼ ì‘ë‹µí•˜ì„¸ìš”:
1. í•­ìƒ ì •ì¤‘í•˜ê³  ê³µê°ì ì¸ íƒœë„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤
2. ê³ ê°ì˜ ì§ˆë¬¸ì„ ì •í™•íˆ ì´í•´í•˜ê³  ëª…í™•í•œ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤
3. í•„ìš”ì‹œ ì¶”ê°€ ì •ë³´ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤
4. ë‹µë³€ì€ ê°„ê²°í•˜ë©´ì„œë„ ì¶©ë¶„í•œ ì •ë³´ë¥¼ ë‹´ìŠµë‹ˆë‹¤
5. ë¶ˆí™•ì‹¤í•œ ì •ë³´ëŠ” ì¶”ì¸¡í•˜ì§€ ì•Šê³  í™•ì¸ì´ í•„ìš”í•˜ë‹¤ê³  ì•ˆë‚´í•©ë‹ˆë‹¤
```

### LLM ì„¤ì •
- **Model**: gpt-4.1-mini (ê¸°ë³¸ê°’)
- **Temperature**: 0.7
- **Max Tokens**: 500
- **Retry**: ìµœëŒ€ 2íšŒ ì¬ì‹œë„
- **Retry Delay**: 1ì´ˆ
- **Timeout**: 30ì´ˆ

### Fallback ë©”ì‹œì§€
```
ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ë¡œ ì‘ë‹µì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì‹œê±°ë‚˜, ìƒë‹´ì› ì—°ê²°ì„ ìš”ì²­í•´ ì£¼ì„¸ìš”.
```

## ğŸ’¡ ì£¼ìš” ì˜ì‚¬ê²°ì •

### 1. í™˜ê²½ ë³€ìˆ˜ ìœ„ì¹˜
**ê²°ì •:** í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ ë°°ì¹˜
**ì´ìœ :**
- Backendì™€ Frontendê°€ ê°™ì€ í™˜ê²½ ë³€ìˆ˜ ê³µìœ  ê°€ëŠ¥
- ë°°í¬ ì‹œ ë‹¨ì¼ ì„¤ì • íŒŒì¼ ê´€ë¦¬ ìš©ì´
- Monorepo êµ¬ì¡°ì— ì í•©

### 2. í…ŒìŠ¤íŠ¸ ì „ëµ
**ê²°ì •:** ìœ ë‹› í…ŒìŠ¤íŠ¸(ëª¨í‚¹) + í†µí•© í…ŒìŠ¤íŠ¸(ì‹¤ì œ API) ë¶„ë¦¬
**ì´ìœ :**
- CI/CDì—ì„œëŠ” ëª¨í‚¹ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰ (ë¹„ìš© 0ì›)
- í”„ë¡œë•ì…˜ ë°°í¬ ì „ í†µí•© í…ŒìŠ¤íŠ¸ë¡œ í’ˆì§ˆ ê²€ì¦
- pytest ë§ˆì»¤(`@pytest.mark.integration`)ë¡œ ì„ íƒì  ì‹¤í–‰

### 3. AI ì‘ë‹µ ì €ì¥
**ê²°ì •:** ê³ ê° ë©”ì‹œì§€ì™€ ë™ì¼í•œ conversationì— sequence=2ë¡œ ì €ì¥
**ì´ìœ :**
- ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥
- ë‹¨ì¼ API í˜¸ì¶œë¡œ ëŒ€í™” íˆìŠ¤í† ë¦¬ ì¡°íšŒ ê°€ëŠ¥
- Phase 2 HITL ê¸°ëŠ¥ ì¶”ê°€ ìš©ì´

### 4. Fallback ì²˜ë¦¬
**ê²°ì •:** LLM ì˜¤ë¥˜ ì‹œ í•œê¸€ ì•ˆë‚´ ë©”ì‹œì§€ ë°˜í™˜ (ì˜ˆì™¸ ë°œìƒí•˜ì§€ ì•ŠìŒ)
**ì´ìœ :**
- ì‚¬ìš©ì ê²½í—˜ ìœ ì§€
- API ì•ˆì •ì„± ë³´ì¥
- ì—ëŸ¬ ë¡œê¹…ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥

## ğŸ“ˆ ì„±ëŠ¥ ë©”íŠ¸ë¦­

### API ì‘ë‹µ ì‹œê°„
- **í‰ê·  ì§€ì—°ì‹œê°„**: ~1.5ì´ˆ (OpenAI API í˜¸ì¶œ í¬í•¨)
- **ìµœì†Œ ì§€ì—°ì‹œê°„**: 1103ms
- **ìµœëŒ€ ì§€ì—°ì‹œê°„**: 2301ms

### í† í° ì‚¬ìš©ëŸ‰
- **í‰ê·  í† í°**: 65 tokens per request
- **ì˜ˆìƒ ë¹„ìš©**: $0.0001 per request (GPT-4.1-mini)
- **ì›”ê°„ ì˜ˆìƒ ë¹„ìš©** (1,000 req/day): ~$3

### í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
- **ìœ ë‹› í…ŒìŠ¤íŠ¸**: 100% (conversation_service.py í•µì‹¬ ë¡œì§)
- **í†µí•© í…ŒìŠ¤íŠ¸**: End-to-end í”Œë¡œìš° ê²€ì¦ ì™„ë£Œ

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### Task 2: Qdrant ë²¡í„° ê²€ìƒ‰ (ìš°ì„ ìˆœìœ„ 1)
- **ëª©í‘œ**: RAG íŒ¨í„´ìœ¼ë¡œ ë¬¸ë§¥ ì¸ì‹ AI ì‘ë‹µ
- **ì˜ˆìƒ ê¸°ê°„**: 4-5ì¼
- **ì£¼ìš” ì‘ì—…**:
  - Qdrant í´ë¼ì´ì–¸íŠ¸ í†µí•©
  - ë²¡í„° ì„ë² ë”© ìƒì„±
  - ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰
  - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— ì»¨í…ìŠ¤íŠ¸ ì£¼ì…

### Task 3: HITL ìŠ¹ì¸ UI (ìš°ì„ ìˆœìœ„ 2)
- **ëª©í‘œ**: AI ì‘ë‹µ ìŠ¹ì¸/ê±°ë¶€ ì›Œí¬í”Œë¡œìš°
- **ì˜ˆìƒ ê¸°ê°„**: 5-6ì¼
- **ì£¼ìš” ì‘ì—…**:
  - ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ ê´€ë¦¬
  - Frontend ìŠ¹ì¸ UI êµ¬í˜„
  - ìŠ¹ì¸/ê±°ë¶€ API ì—”ë“œí¬ì¸íŠ¸
  - ìƒë‹´ì› í”¼ë“œë°± ìˆ˜ì§‘

### Task 4 & 5: Realtime + Dashboard
- **ë³‘ë ¬ ì§„í–‰ ê°€ëŠ¥**
- **ì˜ˆìƒ ê¸°ê°„**: 7-9ì¼

## ğŸ“ í•™ìŠµ ë‚´ìš©

### ê¸°ìˆ ì  ì¸ì‚¬ì´íŠ¸
1. **Pydantic Settings**: í™˜ê²½ ë³€ìˆ˜ íƒ€ì… ì•ˆì „ì„±ê³¼ ê²€ì¦
2. **FastAPI Dependency Injection**: ì‹±ê¸€í†¤ íŒ¨í„´ êµ¬í˜„ (`@lru_cache`)
3. **AsyncOpenAI**: ë¹„ë™ê¸° LLM í˜¸ì¶œì˜ ì„±ëŠ¥ ì´ì 
4. **Pytest Fixtures**: í…ŒìŠ¤íŠ¸ ê²©ë¦¬ì™€ ì¬ì‚¬ìš©ì„±
5. **Repository Pattern**: ë°ì´í„° ì ‘ê·¼ ì¶”ìƒí™”ë¡œ í…ŒìŠ¤íŠ¸ ìš©ì´ì„± í–¥ìƒ

### ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤
1. **í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬**: dotenv + Pydantic Settings
2. **í…ŒìŠ¤íŠ¸ ì „ëµ**: ëª¨í‚¹(ë¹ ë¦„/ë¬´ë£Œ) + í†µí•©(í’ˆì§ˆ ê²€ì¦)
3. **ì—ëŸ¬ ì²˜ë¦¬**: Graceful degradation with fallback
4. **í•œê¸€ ì§€ì›**: UTF-8 ì¸ì½”ë”© + í•œê¸€ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
5. **ë¹„ìš© ê´€ë¦¬**: í† í° ì œí•œ + Retry ì œí•œ

## ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

### ìˆ˜ì •ëœ íŒŒì¼ (6ê°œ)
1. `backend/app/services/conversation_service.py` - LLM í†µí•©
2. `backend/app/api/routes/conversations.py` - ì˜ì¡´ì„± ì£¼ì…
3. `backend/core/config/__init__.py` - í™˜ê²½ ë³€ìˆ˜ ê²½ë¡œ ìˆ˜ì •
4. `backend/app/repositories/conversation_repository.py` - ë²„ê·¸ ìˆ˜ì •
5. `backend/tests/contract/test_conversations.py` - í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€

### ìƒì„±ëœ íŒŒì¼ (3ê°œ)
1. `backend/tests/unit/test_conversation_service.py` - ìœ ë‹› í…ŒìŠ¤íŠ¸
2. `backend/tests/integration/test_llm_integration.py` - í†µí•© í…ŒìŠ¤íŠ¸
3. `docs/testing-llm-integration.md` - í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] LLM ì„œë¹„ìŠ¤ í†µí•©
- [x] API ë¼ìš°íŠ¸ ìˆ˜ì •
- [x] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [x] ìœ ë‹› í…ŒìŠ¤íŠ¸ ì‘ì„± (6ê°œ)
- [x] í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„± (5ê°œ)
- [x] ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼
- [x] ë¬¸ì„œí™” ì™„ë£Œ
- [x] ì‹¤ì œ API ê²€ì¦
- [x] í•œê¸€ ì‘ë‹µ í’ˆì§ˆ í™•ì¸
- [x] Fallback ë©”ì»¤ë‹ˆì¦˜ ê²€ì¦
- [x] ë©”íƒ€ë°ì´í„° ë³´ì¡´ í™•ì¸

## ğŸ‰ ê²°ë¡ 

Task 1 (LLM í†µí•©)ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. POST `/v1/conversations` APIëŠ” ì´ì œ ê³ ê° ë©”ì‹œì§€ì— ëŒ€í•´ ìë™ìœ¼ë¡œ AI ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.

**ì£¼ìš” ì„±ê³¼:**
- âœ… 11ê°œ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼ (ìœ ë‹› 6ê°œ + í†µí•© 5ê°œ)
- âœ… ì‹¤ì œ OpenAI API ì—°ë™ ê²€ì¦ ì™„ë£Œ
- âœ… í•œê¸€ ì‘ë‹µ í’ˆì§ˆ ìš°ìˆ˜
- âœ… í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

**ë‹¤ìŒ ì‘ì—…:**
Task 2 (Qdrant)ì™€ Task 3 (HITL)ë¥¼ ë³‘ë ¬ë¡œ ì§„í–‰í•˜ì—¬ 14-18ì¼ ë‚´ì— ì „ì²´ MVP ì™„ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.
